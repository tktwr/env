#!/bin/sh

cols=$(tput cols)

bin_name=`basename $0`
memo_dir="$MY_LOCAL_CONFIG/memo"
tags="$MY_REMOTE_CONFIG/memo/tags.memo $MY_REMOTE_CONFIG/samples/tags.memo $MY_LOCAL_CONFIG/memo/tags.memo"

f_print_tags() {
  for i in $tags; do
    echo "[$i]"
    awk '{print $1}' $i | grep '^memo_' | sed 's/memo_//' | column -c $cols
    echo
  done
}

f_help() {
  echo "NAME"
  echo "  $bin_name"
  echo
  echo "SYNOPSIS"
  echo "  $bin_name [options] [tag]"
  echo
  echo "OPTIONS"
  echo "  -h, --help   print help"
  echo "  -p           print tags"
  echo
  echo "TAGS"
  f_print_tags
}

f_main() {
  if [ $# -eq 1 ]; then
    case $1 in
      -h|--help)
        f_help
        exit
        ;;
      -p)
        f_print_tags
        exit
        ;;
      *)
        vim -t "memo_$1" -c "normal zt"
        ;;
    esac
  else
    vim $memo_dir/memo.md.html
  fi
}

f_main $*

